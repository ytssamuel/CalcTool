<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è²¡å¯Œè‡ªç”±è¨ˆç®—å™¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="common-styles.css">
  <style>
    /* é é¢ç‰¹å®šæ¨£å¼ */
    body {
      background: linear-gradient(135deg, #FFD89B 0%, #19547B 100%);
    }
    
    .container {
      max-width: 1000px;
      background: white;
    }
    
    h1 {
      color: #333;
      text-shadow: 2px 2px 4px rgba(255,255,255,0.5);
    }
    
    .input-row {
      margin-bottom: 1.5em;
    }
    
    .label-hint {
      font-weight: normal;
      color: #666;
      font-size: 0.9em;
      margin-left: 0.5em;
    }
    
    .input-group-inline {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1em;
    }
    
    .summary-overview {
      background: linear-gradient(135deg, #FFD89B 0%, #19547B 100%);
      color: white;
      padding: 2em;
      border-radius: 10px;
      margin-bottom: 2em;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .summary-overview h2 {
      margin-top: 0;
      color: white;
      border: none;
      text-align: center;
      margin-bottom: 1.5em;
    }
    
    .big-number {
      font-size: 2.5em;
      font-weight: bold;
      text-align: center;
      margin: 0.5em 0;
      color: white;
    }
    
    .summary-subtitle {
      font-size: 1.1em;
      text-align: center;
      margin-bottom: 1.5em;
      color: white;
      opacity: 0.95;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1em;
    }
    
    .stat-box {
      background: rgba(255,255,255,0.2);
      padding: 1em;
      border-radius: 8px;
      text-align: center;
    }
    
    .stat-label {
      font-size: 0.9em;
      opacity: 0.9;
      margin-bottom: 0.5em;
    }
    
    .stat-value {
      font-size: 1.5em;
      font-weight: bold;
    }
    
    .concept-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1.5em;
      border-radius: 10px;
      margin-bottom: 2em;
    }
    
    .concept-box h3 {
      margin-top: 0;
      color: white;
      border: none;
    }
    
    .concept-item {
      background: rgba(255,255,255,0.2);
      padding: 1em;
      border-radius: 8px;
      margin-bottom: 1em;
    }
    
    .concept-item:last-child {
      margin-bottom: 0;
    }
    
    .concept-title {
      font-weight: bold;
      margin-bottom: 0.5em;
      font-size: 1.1em;
    }
    
    .concept-desc {
      opacity: 0.95;
      line-height: 1.6;
    }
    
    .strategy-box {
      background: #f8f9fa;
      padding: 1.5em;
      border-radius: 10px;
      margin-bottom: 2em;
      border: 2px solid #FFD89B;
    }
    
    .strategy-box h3 {
      margin-top: 0;
      color: #19547B;
      border-bottom: 2px solid #FFD89B;
      padding-bottom: 0.5em;
    }
    
    .strategy-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1em;
      margin-top: 1em;
    }
    
    .strategy-item {
      background: white;
      padding: 1em;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .strategy-title {
      font-weight: bold;
      color: #19547B;
      margin-bottom: 0.5em;
    }
    
    .strategy-desc {
      color: #666;
      line-height: 1.6;
      font-size: 0.95em;
    }
    
    .hidden {
      display: none;
    }
    
    .formula-box {
      background: #e3f2fd;
      padding: 1.5em;
      border-radius: 8px;
      margin: 1.5em 0;
      border-left: 4px solid #2196F3;
    }
    
    .formula-title {
      font-weight: bold;
      color: #1976D2;
      margin-bottom: 0.8em;
      font-size: 1.1em;
    }
    
    .formula {
      font-family: 'Courier New', monospace;
      background: white;
      padding: 1em;
      border-radius: 4px;
      text-align: center;
      font-size: 1.1em;
      color: #333;
    }
    
    .formula-explain {
      margin-top: 0.8em;
      color: #666;
      font-size: 0.95em;
      line-height: 1.6;
    }
    
    @media (max-width: 768px) {
      .input-group-inline,
      .strategy-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .big-number {
        font-size: 2em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ’° è²¡å¯Œè‡ªç”±è¨ˆç®—å™¨</h1>

    <div class="input-group">
      <div class="info-box">
        <p>ğŸ“Œ æ­¤å·¥å…·å¯å¹«æ‚¨è¨ˆç®—é”åˆ°è²¡å¯Œè‡ªç”±æ‰€éœ€çš„è³‡ç”¢ç¸½é¡ï¼Œè®“è¢«å‹•æ”¶å…¥æ”¯æ‡‰æ‚¨çš„ç”Ÿæ´»é–‹éŠ·</p>
      </div>

      <div class="input-row">
        <label>
          æ¯æœˆç”Ÿæ´»è²»ï¼ˆå…ƒï¼‰:
          <span class="label-hint">æœŸæœ›çš„æœˆç”Ÿæ´»é–‹éŠ·</span>
        </label>
        <input type="number" id="monthlyExpense" placeholder="ä¾‹å¦‚ï¼š50000" value="50000">
      </div>

      <div class="input-group-inline">
        <div class="input-row">
          <label>
            å¹´é€šè²¨è†¨è„¹ç‡ï¼ˆ%ï¼‰:
            <span class="label-hint">å°ç£å¹³å‡ç´„ 1.5-2%</span>
          </label>
          <input type="number" id="inflationRate" placeholder="ä¾‹å¦‚ï¼š2" value="2" step="0.1">
        </div>
        
        <div class="input-row">
          <label>
            æŠ•è³‡å¹´å ±é…¬ç‡ï¼ˆ%ï¼‰:
            <span class="label-hint">é æœŸçš„å¹´åŒ–å ±é…¬ç‡</span>
          </label>
          <input type="number" id="returnRate" placeholder="ä¾‹å¦‚ï¼š6" value="6" step="0.1">
        </div>
      </div>

      <div class="input-group-inline">
        <div class="input-row">
          <label>
            ç›®å‰å¹´é½¡:
            <span class="label-hint">æ­²</span>
          </label>
          <input type="number" id="currentAge" placeholder="ä¾‹å¦‚ï¼š30" value="30" min="18" max="100">
        </div>
        
        <div class="input-row">
          <label>
            ç›®æ¨™é”æˆå¹´é½¡:
            <span class="label-hint">è¨ˆåŠƒå¹¾æ­²é”æˆè²¡å¯Œè‡ªç”±</span>
          </label>
          <input type="number" id="targetAge" placeholder="ä¾‹å¦‚ï¼š45" value="45" min="18" max="100">
        </div>
      </div>

      <div class="input-row">
        <label>
          ç›®å‰å·²æœ‰è³‡ç”¢ï¼ˆå…ƒï¼‰:
          <span class="label-hint">å¯é¸å¡«ï¼Œé è¨­ç‚º 0</span>
        </label>
        <input type="number" id="currentAsset" placeholder="ä¾‹å¦‚ï¼š1000000" value="0">
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick="calculate()">é–‹å§‹è¨ˆç®—</button>
        <button class="btn-secondary hidden" id="downloadBtn" onclick="downloadCSV()">ä¸‹è¼‰çµæœï¼ˆCSVï¼‰</button>
      </div>
    </div>

    <div class="hidden" id="result">
      <div class="summary-overview">
        <h2>ğŸ¯ è²¡å¯Œè‡ªç”±ç›®æ¨™</h2>
        <div class="big-number" id="targetAmount">-</div>
        <div class="summary-subtitle">é”æˆè²¡å¯Œè‡ªç”±æ‰€éœ€è³‡ç”¢ç¸½é¡</div>
        
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-label">æ¯æœˆè¢«å‹•æ”¶å…¥</div>
            <div class="stat-value" id="passiveIncome">-</div>
          </div>
          <div class="stat-box">
            <div class="stat-label">å¹´åº¦è¢«å‹•æ”¶å…¥</div>
            <div class="stat-value" id="annualPassiveIncome">-</div>
          </div>
          <div class="stat-box">
            <div class="stat-label">æ¯æœˆæ‡‰å­˜é‡‘é¡</div>
            <div class="stat-value" id="monthlySaving">-</div>
          </div>
          <div class="stat-box">
            <div class="stat-label">è·é›¢ç›®æ¨™</div>
            <div class="stat-value" id="yearsToTarget">-</div>
          </div>
        </div>
      </div>

      <div class="formula-box">
        <div class="formula-title">ğŸ’¡ è²¡å¯Œè‡ªç”±å…¬å¼</div>
        <div class="formula">
          è²¡å¯Œè‡ªç”±é‡‘é¡ = å¹´åº¦ç”Ÿæ´»è²» Ã· å¯¦è³ªå ±é…¬ç‡
        </div>
        <div class="formula-explain">
          <strong>å¯¦è³ªå ±é…¬ç‡</strong> = æŠ•è³‡å ±é…¬ç‡ - é€šè²¨è†¨è„¹ç‡<br>
          ç•¶æ‚¨çš„è³‡ç”¢ç”¢ç”Ÿçš„è¢«å‹•æ”¶å…¥ï¼ˆå¯¦è³ªå ±é…¬ï¼‰è¶³ä»¥æ”¯æ‡‰ç”Ÿæ´»è²»æ™‚ï¼Œå³é”åˆ°è²¡å¯Œè‡ªç”±ã€‚<br>
          æœ¬è¨ˆç®—æ¡ç”¨ã€Œ4% æ³•å‰‡ã€çš„å»¶ä¼¸æ¦‚å¿µï¼Œç¢ºä¿è³‡ç”¢æœ¬é‡‘ä¸æœƒè¢«ä¾µè•ã€‚
        </div>
      </div>

      <div class="concept-box">
        <h3>ğŸ’¡ è²¡å¯Œè‡ªç”±æ ¸å¿ƒæ¦‚å¿µ</h3>
        <div class="concept-item">
          <div class="concept-title">ğŸ¯ è¢«å‹•æ”¶å…¥ â‰¥ ç”Ÿæ´»æ”¯å‡º</div>
          <div class="concept-desc">
            è²¡å¯Œè‡ªç”±çš„é—œéµåœ¨æ–¼ã€Œè¢«å‹•æ”¶å…¥èƒ½å¤ å®Œå…¨æ”¯æ‡‰ç”Ÿæ´»é–‹éŠ·ã€ï¼Œè€Œä¸éœ€è¦å‹•ç”¨æœ¬é‡‘ã€‚
            é€™æ„å‘³è‘—æ‚¨çš„è³‡ç”¢æŠ•è³‡å ±é…¬ï¼Œæ‰£é™¤é€šè†¨å½±éŸ¿å¾Œï¼Œèƒ½å¤ ç”¢ç”Ÿè¶³å¤ çš„ç¾é‡‘æµæ”¯ä»˜æ‰€æœ‰ç”Ÿæ´»è²»ç”¨ã€‚
          </div>
        </div>
        <div class="concept-item">
          <div class="concept-title">ğŸ“Š è³‡ç”¢æ°¸çºŒæ€§</div>
          <div class="concept-desc">
            æœ¬è¨ˆç®—å™¨æ¡ç”¨ä¿å®ˆç­–ç•¥ï¼Œç¢ºä¿æ‚¨çš„è³‡ç”¢æœ¬é‡‘èƒ½å¤ æ°¸çºŒå­˜åœ¨ã€‚è³‡ç”¢å¢å€¼çš„éƒ¨åˆ†ç”¨æ–¼ï¼š
            (1) æŠµæŠ—é€šè†¨ä¾µè•ã€(2) æä¾›ç”Ÿæ´»è²»ã€(3) æŒçºŒå¢é•·è³‡ç”¢ã€‚é€™æ¨£å³ä½¿é¢å°ç¶“æ¿Ÿæ³¢å‹•ï¼Œ
            æ‚¨çš„è²¡å¯Œè‡ªç”±ç‹€æ…‹ä¹Ÿèƒ½é•·æœŸç¶­æŒã€‚
          </div>
        </div>
        <div class="concept-item">
          <div class="concept-title">ğŸ”„ å¯¦è³ªå ±é…¬ç‡</div>
          <div class="concept-desc">
            å¯¦è³ªå ±é…¬ç‡ = æŠ•è³‡å ±é…¬ç‡ - é€šè†¨ç‡ã€‚ä¾‹å¦‚ï¼šæŠ•è³‡å ±é…¬ç‡ 6%ã€é€šè†¨ç‡ 2%ï¼Œ
            å¯¦è³ªå ±é…¬ç‡ç‚º 4%ã€‚é€™ 4% æ‰æ˜¯çœŸæ­£èƒ½å¤ æ”¯æ‡‰ç”Ÿæ´»ã€ç¶­æŒè³¼è²·åŠ›çš„æ”¶ç›Šã€‚
            è¨ˆç®—æ™‚å»ºè­°æ¡ç”¨ä¿å®ˆä¼°è¨ˆï¼Œç¢ºä¿ç›®æ¨™å¯è¡Œã€‚
          </div>
        </div>
      </div>

      <div class="strategy-box">
        <h3>ğŸ¯ é”æˆè²¡å¯Œè‡ªç”±çš„ç­–ç•¥å»ºè­°</h3>
        <div class="strategy-grid">
          <div class="strategy-item">
            <div class="strategy-title">ğŸ“ˆ æé«˜æ”¶å…¥</div>
            <div class="strategy-desc">
              å¢åŠ ä¸»å‹•æ”¶å…¥æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ã€‚é€éæå‡å°ˆæ¥­èƒ½åŠ›ã€è½‰æ›å·¥ä½œã€ç™¼å±•å‰¯æ¥­ç­‰æ–¹å¼ï¼Œ
              æé«˜æ¯æœˆå¯æŠ•è³‡é‡‘é¡ã€‚
            </div>
          </div>
          <div class="strategy-item">
            <div class="strategy-title">ğŸ’° é™ä½æ”¯å‡º</div>
            <div class="strategy-desc">
              æª¢è¦–æ¶ˆè²»ç¿’æ…£ï¼Œå€åˆ†éœ€è¦èˆ‡æƒ³è¦ã€‚é™ä½éå¿…è¦æ”¯å‡ºï¼Œ
              æé«˜å„²è“„ç‡ã€‚æ¯é™ä½ 10% æ”¯å‡ºï¼Œè²¡å¯Œè‡ªç”±ç›®æ¨™å°±æ›´å®¹æ˜“é”æˆã€‚
            </div>
          </div>
          <div class="strategy-item">
            <div class="strategy-title">ğŸ“Š å„ªåŒ–æŠ•è³‡</div>
            <div class="strategy-desc">
              é¸æ“‡é©åˆçš„æŠ•è³‡å·¥å…·ï¼Œå¹³è¡¡é¢¨éšªèˆ‡å ±é…¬ã€‚é•·æœŸæŠ•è³‡æŒ‡æ•¸å‹åŸºé‡‘ã€
              é«˜è‚¡æ¯è‚¡ç¥¨ã€REITs ç­‰ï¼Œéƒ½æ˜¯å‰µé€ è¢«å‹•æ”¶å…¥çš„å¥½é¸æ“‡ã€‚
            </div>
          </div>
          <div class="strategy-item">
            <div class="strategy-title">â° æ™‚é–“è¤‡åˆ©</div>
            <div class="strategy-desc">
              è¶Šæ—©é–‹å§‹æŠ•è³‡ï¼Œè¤‡åˆ©æ•ˆæœè¶Šé¡¯è‘—ã€‚å³ä½¿æ¯æœˆæŠ•å…¥é‡‘é¡ä¸å¤§ï¼Œ
              é•·æœŸç´¯ç©ä¸‹ä¾†ä¹Ÿèƒ½å‰µé€ å¯è§€çš„è²¡å¯Œã€‚
            </div>
          </div>
          <div class="strategy-item">
            <div class="strategy-title">ğŸ“ æŒçºŒå­¸ç¿’</div>
            <div class="strategy-desc">
              æŠ•è³‡ç†è²¡çŸ¥è­˜éœ€è¦æŒçºŒå­¸ç¿’ã€‚äº†è§£å¸‚å ´å‹•æ…‹ã€è³‡ç”¢é…ç½®ã€
              é¢¨éšªç®¡ç†ç­‰ï¼Œæ‰èƒ½åšå‡ºæ›´æ˜æ™ºçš„æ±ºç­–ã€‚
            </div>
          </div>
          <div class="strategy-item">
            <div class="strategy-title">ğŸ›¡ï¸ é¢¨éšªç®¡ç†</div>
            <div class="strategy-desc">
              å»ºç«‹ç·Šæ€¥é å‚™é‡‘ã€è³¼è²·é©ç•¶ä¿éšªã€åˆ†æ•£æŠ•è³‡é¢¨éšªã€‚
              è²¡å¯Œè‡ªç”±ä¸åªæ˜¯ç´¯ç©è³‡ç”¢ï¼Œæ›´è¦ä¿è­·å¥½å·²æœ‰çš„è²¡å¯Œã€‚
            </div>
          </div>
        </div>
      </div>

      <h3 style="color: #333;">ğŸ“Š è³‡ç”¢æˆé•·è·¯å¾‘</h3>
      <div id="growthPath"></div>
    </div>
  </div>

  <script>
    let cachedData = [];

    function calculate() {
      const monthlyExpense = parseFloat(document.getElementById('monthlyExpense').value);
      const inflationRate = parseFloat(document.getElementById('inflationRate').value) / 100;
      const returnRate = parseFloat(document.getElementById('returnRate').value) / 100;
      const currentAge = parseInt(document.getElementById('currentAge').value);
      const targetAge = parseInt(document.getElementById('targetAge').value);
      const currentAsset = parseFloat(document.getElementById('currentAsset').value) || 0;

      if (isNaN(monthlyExpense) || isNaN(inflationRate) || isNaN(returnRate) || 
          isNaN(currentAge) || isNaN(targetAge)) {
        alert('è«‹è¼¸å…¥æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼');
        return;
      }

      if (targetAge <= currentAge) {
        alert('ç›®æ¨™é”æˆå¹´é½¡å¿…é ˆå¤§æ–¼ç›®å‰å¹´é½¡ï¼');
        return;
      }

      if (monthlyExpense <= 0) {
        alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æœˆç”Ÿæ´»è²»ï¼');
        return;
      }

      if (returnRate <= inflationRate) {
        alert('æŠ•è³‡å ±é…¬ç‡å¿…é ˆå¤§æ–¼é€šè†¨ç‡ï¼Œæ‰èƒ½å¯¦ç¾è²¡å¯Œè‡ªç”±ï¼');
        return;
      }

      const yearsToTarget = targetAge - currentAge;
      
      // è¨ˆç®—å¯¦è³ªå ±é…¬ç‡ï¼ˆæ‰£é™¤é€šè†¨å¾Œçš„çœŸå¯¦å ±é…¬ï¼‰
      const realReturnRate = returnRate - inflationRate;
      
      // è¨ˆç®—å¹´åº¦ç”Ÿæ´»è²»ï¼ˆç•¶å‰ç‰©åƒ¹ï¼‰
      const annualExpense = monthlyExpense * 12;
      
      // è²¡å¯Œè‡ªç”±æ‰€éœ€é‡‘é¡ = å¹´åº¦ç”Ÿæ´»è²» / å¯¦è³ªå ±é…¬ç‡
      // é€™å€‹é‡‘é¡çš„å¯¦è³ªå ±é…¬å‰›å¥½å¯ä»¥æ”¯æ‡‰ç”Ÿæ´»è²»ï¼Œæœ¬é‡‘ä¸æœƒæ¸›å°‘
      const targetAmount = annualExpense / realReturnRate;
      
      // è€ƒæ…®é€šè†¨ï¼Œè¨ˆç®—ç›®æ¨™å¹´é½¡æ™‚çš„ç”Ÿæ´»è²»
      const futureAnnualExpense = annualExpense * Math.pow(1 + inflationRate, yearsToTarget);
      const futureTargetAmount = futureAnnualExpense / realReturnRate;
      
      // è¨ˆç®—æ¯æœˆæ‡‰å­˜é‡‘é¡
      const monthsToTarget = yearsToTarget * 12;
      const monthlyReturnRate = Math.pow(1 + returnRate, 1/12) - 1;
      
      // è€ƒæ…®ç›®å‰å·²æœ‰è³‡ç”¢çš„æœªä¾†å€¼
      const futureCurrentAsset = currentAsset * Math.pow(1 + returnRate, yearsToTarget);
      const stillNeed = futureTargetAmount - futureCurrentAsset;
      
      let monthlySaving = 0;
      if (stillNeed > 0) {
        if (monthlyReturnRate > 0.0001) {
          monthlySaving = stillNeed * monthlyReturnRate / (Math.pow(1 + monthlyReturnRate, monthsToTarget) - 1);
        } else {
          monthlySaving = stillNeed / monthsToTarget;
        }
      }

      // è¨ˆç®—è¢«å‹•æ”¶å…¥
      const monthlyPassiveIncome = targetAmount * realReturnRate / 12;
      const annualPassiveIncome = targetAmount * realReturnRate;

      // æ›´æ–°ç¸½è¦½
      document.getElementById('targetAmount').textContent = '$ ' + Math.round(targetAmount).toLocaleString('zh-TW');
      document.getElementById('passiveIncome').textContent = Math.round(monthlyPassiveIncome).toLocaleString('zh-TW') + ' å…ƒ';
      document.getElementById('annualPassiveIncome').textContent = Math.round(annualPassiveIncome).toLocaleString('zh-TW') + ' å…ƒ';
      document.getElementById('monthlySaving').textContent = Math.round(Math.max(0, monthlySaving)).toLocaleString('zh-TW') + ' å…ƒ';
      document.getElementById('yearsToTarget').textContent = yearsToTarget + ' å¹´';

      // ç”Ÿæˆè³‡ç”¢æˆé•·è·¯å¾‘
      let pathHTML = '<div class="table-container"><table><thead><tr>';
      pathHTML += '<th>å¹´é½¡</th><th>å¹´åº¦</th><th>ç´¯ç©è³‡ç”¢ï¼ˆå…ƒï¼‰</th><th>å¹´åº¦ç”Ÿæ´»è²»ï¼ˆå…ƒï¼‰</th>';
      pathHTML += '<th>è¢«å‹•æ”¶å…¥ï¼ˆå…ƒï¼‰</th><th>æ”¶å…¥è¦†è“‹ç‡</th></tr></thead><tbody>';

      cachedData = [];
      let accumulatedAsset = currentAsset;

      for (let year = 0; year <= yearsToTarget; year++) {
        const age = currentAge + year;
        const yearExpense = annualExpense * Math.pow(1 + inflationRate, year);
        const passiveIncome = accumulatedAsset * realReturnRate;
        const coverageRatio = accumulatedAsset > 0 ? (passiveIncome / yearExpense * 100) : 0;
        
        cachedData.push({
          year: year,
          age: age,
          asset: Math.round(accumulatedAsset),
          expense: Math.round(yearExpense),
          passiveIncome: Math.round(passiveIncome),
          coverageRatio: coverageRatio.toFixed(1)
        });

        const rowClass = coverageRatio >= 100 ? 'style="background: #e8f5e9;"' : '';
        pathHTML += `<tr ${rowClass}>`;
        pathHTML += `<td><strong>${age} æ­²</strong></td>`;
        pathHTML += `<td>ç¬¬ ${year} å¹´</td>`;
        pathHTML += `<td>${Math.round(accumulatedAsset).toLocaleString('zh-TW')}</td>`;
        pathHTML += `<td>${Math.round(yearExpense).toLocaleString('zh-TW')}</td>`;
        pathHTML += `<td>${Math.round(passiveIncome).toLocaleString('zh-TW')}</td>`;
        pathHTML += `<td><strong>${coverageRatio.toFixed(1)}%</strong></td>`;
        pathHTML += '</tr>';

        // è¨ˆç®—ä¸‹ä¸€å¹´è³‡ç”¢ï¼ˆè³‡ç”¢å¢å€¼ + æ¯æœˆå„²è“„ï¼‰
        if (year < yearsToTarget) {
          accumulatedAsset = accumulatedAsset * (1 + returnRate) + monthlySaving * 12;
        }
      }

      pathHTML += '</tbody></table></div>';
      document.getElementById('growthPath').innerHTML = pathHTML;

      // é¡¯ç¤ºçµæœ
      document.getElementById('result').classList.remove('hidden');
      document.getElementById('downloadBtn').classList.remove('hidden');
    }

    function downloadCSV() {
      if (cachedData.length === 0) {
        alert('è«‹å…ˆè¨ˆç®—çµæœ');
        return;
      }

      const monthlyExpense = parseFloat(document.getElementById('monthlyExpense').value);
      const inflationRate = parseFloat(document.getElementById('inflationRate').value);
      const returnRate = parseFloat(document.getElementById('returnRate').value);
      const currentAge = parseInt(document.getElementById('currentAge').value);
      const targetAge = parseInt(document.getElementById('targetAge').value);

      let csvContent = '\uFEFF'; // UTF-8 BOM
      csvContent += 'è²¡å¯Œè‡ªç”±è¨ˆç®—çµæœ\n';
      csvContent += `æ¯æœˆç”Ÿæ´»è²»,${monthlyExpense}\n`;
      csvContent += `é€šè²¨è†¨è„¹ç‡,${inflationRate}%\n`;
      csvContent += `æŠ•è³‡å ±é…¬ç‡,${returnRate}%\n`;
      csvContent += `ç›®å‰å¹´é½¡,${currentAge}\n`;
      csvContent += `ç›®æ¨™å¹´é½¡,${targetAge}\n\n`;
      csvContent += 'å¹´é½¡,å¹´åº¦,ç´¯ç©è³‡ç”¢ï¼ˆå…ƒï¼‰,å¹´åº¦ç”Ÿæ´»è²»ï¼ˆå…ƒï¼‰,è¢«å‹•æ”¶å…¥ï¼ˆå…ƒï¼‰,æ”¶å…¥è¦†è“‹ç‡\n';
      
      cachedData.forEach(data => {
        csvContent += `${data.age},ç¬¬${data.year}å¹´,${data.asset},${data.expense},${data.passiveIncome},${data.coverageRatio}%\n`;
      });

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.setAttribute('href', URL.createObjectURL(blob));
      link.setAttribute('download', 'è²¡å¯Œè‡ªç”±è¨ˆç®—çµæœ.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // æŒ‰ Enter éµä¹Ÿå¯ä»¥è¨ˆç®—
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        calculate();
      }
    });
  </script>
</body>
</html>
