<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¹´è–ªè¨ˆç®—å·¥å…·</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/svg+xml" href="icon.svg">
  <link rel="stylesheet" href="common-styles.css">
  <style>
    /* é é¢ç‰¹å®šæ¨£å¼ */
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    h1 {
      color: #333;
      text-shadow: 2px 2px 4px rgba(255,255,255,0.5);
    }
    
    .container {
      background: white;
      margin-top: 0;
    }
    
    .input-row {
      margin-bottom: 1.5em;
    }
    
    .label-hint {
      font-weight: normal;
      color: #666;
      font-size: 0.9em;
      margin-left: 0.5em;
    }
    
    input[readonly] {
      background-color: #e9ecef;
    }
    
    .input-group-inline {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1em;
    }
    
    .summary-special {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      padding: 2em;
      border-radius: 10px;
      margin-bottom: 2em;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .summary-special h2 {
      margin-top: 0;
      font-size: 1.6em;
      text-align: center;
      margin-bottom: 1em;
      color: white;
      border: none;
    }
    
    .big-number {
      text-align: center;
      font-size: 3em;
      font-weight: bold;
      margin: 0.5em 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    
    .summary-subtitle {
      text-align: center;
      font-size: 1.2em;
      opacity: 0.9;
    }
    
    .breakdown {
      background: #f8f9fa;
      padding: 1.5em;
      border-radius: 8px;
      margin-top: 1.5em;
    }
    
    .breakdown h3 {
      margin-top: 0;
      color: #333;
      font-size: 1.3em;
      margin-bottom: 1em;
    }
    
    .breakdown-item {
      display: flex;
      justify-content: space-between;
      padding: 0.8em 0;
      border-bottom: 1px solid #dee2e6;
      font-size: 1.1em;
    }
    
    .breakdown-item:last-child {
      border-bottom: none;
      padding-top: 1em;
      margin-top: 0.5em;
      border-top: 2px solid #667eea;
      font-weight: bold;
      font-size: 1.2em;
    }
    
    .breakdown-item .label {
      color: #555;
    }
    
    .breakdown-item .value {
      font-weight: bold;
      color: #667eea;
    }
    
    .breakdown-item:last-child .value {
      color: #f5576c;
      font-size: 1.3em;
    }
    
    .hidden {
      display: none;
    }
    
    th, td {
      text-align: center;
    }
    
    @media (max-width: 600px) {
      .input-group-inline {
        grid-template-columns: 1fr;
      }
      .big-number {
        font-size: 2em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ’° å¹´è–ªè¨ˆç®—å·¥å…·</h1>

    <div class="input-group">
      <div class="info-box">
        <p>ğŸ“Œ æ­¤å·¥å…·å¯å¹«æ‚¨è¨ˆç®—å¹´åº¦ç¸½æ”¶å…¥ï¼ŒåŒ…å«åº•è–ªã€å¹´çµ‚çé‡‘ã€é¡å¤–çé‡‘åŠåŠ ç­è²»</p>
      </div>

      <div class="input-row">
        <label>
          æ¯æœˆåº•è–ªï¼ˆå…ƒï¼‰:
          <span class="label-hint">å›ºå®šæœˆè–ª</span>
        </label>
        <input type="number" id="baseSalary" placeholder="ä¾‹å¦‚ï¼š40000" value="40000">
      </div>

      <div class="input-row">
        <label>
          ç¸½å¹´è–ªæœˆæ•¸:
          <span class="label-hint">ä¾‹å¦‚ï¼š14 ä»£è¡¨ 12å€‹æœˆè–ªæ°´ + 2å€‹æœˆå¹´çµ‚</span>
        </label>
        <input type="number" id="totalMonths" placeholder="ä¾‹å¦‚ï¼š14" value="14" step="0.5">
      </div>

      <div class="input-row">
        <label>
          ä¸‰ç¯€çé‡‘ï¼ˆå…ƒï¼‰:
          <span class="label-hint">æ˜¥ç¯€ã€ç«¯åˆã€ä¸­ç§‹</span>
        </label>
        <input type="number" id="holidayBonus" placeholder="ä¾‹å¦‚ï¼š30000" value="0">
      </div>

      <div class="input-row">
        <label>
          ç¸¾æ•ˆçé‡‘ï¼ˆå…ƒï¼‰:
          <span class="label-hint">å¹´åº¦ç¸¾æ•ˆçé‡‘</span>
        </label>
        <input type="number" id="performanceBonus" placeholder="ä¾‹å¦‚ï¼š50000" value="0">
      </div>

      <div class="input-row">
        <label>
          å…¶ä»–çé‡‘ï¼ˆå…ƒï¼‰:
          <span class="label-hint">å°ˆæ¡ˆçé‡‘ã€ç‰¹åˆ¥çé‡‘ç­‰</span>
        </label>
        <input type="number" id="otherBonus" placeholder="ä¾‹å¦‚ï¼š20000" value="0">
      </div>

      <div class="input-group-inline">
        <div class="input-row">
          <label>
            æ¯æœˆåŠ ç­æ™‚æ•¸:
          </label>
          <input type="number" id="overtimeHours" placeholder="ä¾‹å¦‚ï¼š20" value="0">
        </div>
        <div class="input-row">
          <label>
            æ¯å°æ™‚æ™‚è–ªï¼ˆå…ƒï¼‰:
            <span class="label-hint">åº•è–ªÃ·240</span>
          </label>
          <input type="number" id="hourlyRate" placeholder="è‡ªå‹•è¨ˆç®—" readonly style="background-color: #f0f0f0;">
        </div>
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick="calculate()">è¨ˆç®—å¹´è–ª</button>
        <button class="btn-secondary hidden" id="downloadBtn" onclick="downloadCSV()">ä¸‹è¼‰çµæœï¼ˆCSVï¼‰</button>
      </div>
    </div>

    <div class="hidden" id="result">
      <div class="summary-special">
        <h2>ğŸ¯ æ‚¨çš„å¹´åº¦ç¸½æ”¶å…¥</h2>
        <div class="big-number" id="totalAnnual">-</div>
        <div class="summary-subtitle">ç¨…å‰å¹´æ”¶å…¥</div>
      </div>

      <div class="breakdown">
        <h3>ğŸ’µ æ”¶å…¥æ˜ç´°</h3>
        <div class="breakdown-item">
          <span class="label">ğŸ“… æœˆè–ªæ”¶å…¥ï¼ˆ12å€‹æœˆï¼‰ï¼š</span>
          <span class="value" id="monthlySalaryTotal">-</span>
        </div>
        <div class="breakdown-item">
          <span class="label">ğŸ å¹´çµ‚çé‡‘ï¼š</span>
          <span class="value" id="yearEndBonus">-</span>
        </div>
        <div class="breakdown-item">
          <span class="label">ğŸŠ ä¸‰ç¯€çé‡‘ï¼š</span>
          <span class="value" id="holidayBonusDisplay">-</span>
        </div>
        <div class="breakdown-item">
          <span class="label">ğŸ† ç¸¾æ•ˆçé‡‘ï¼š</span>
          <span class="value" id="performanceBonusDisplay">-</span>
        </div>
        <div class="breakdown-item">
          <span class="label">ğŸ’ å…¶ä»–çé‡‘ï¼š</span>
          <span class="value" id="otherBonusDisplay">-</span>
        </div>
        <div class="breakdown-item">
          <span class="label">â° å¹´åº¦åŠ ç­è²»ï¼š</span>
          <span class="value" id="overtimeTotal">-</span>
        </div>
        <div class="breakdown-item">
          <span class="label">ğŸ’° å¹´åº¦ç¸½æ”¶å…¥ï¼š</span>
          <span class="value" id="finalTotal">-</span>
        </div>
      </div>

      <h3 style="margin-top: 2em; color: #333;">ğŸ“Š æ¯æœˆæ”¶å…¥æ˜ç´°è¡¨</h3>
      <div style="overflow-x: auto;">
        <table id="resultTable">
          <thead>
            <tr>
              <th>æœˆä»½</th>
              <th>åº•è–ªï¼ˆå…ƒï¼‰</th>
              <th>åŠ ç­è²»ï¼ˆå…ƒï¼‰</th>
              <th>çé‡‘ï¼ˆå…ƒï¼‰</th>
              <th>æœˆæ”¶å…¥ï¼ˆå…ƒï¼‰</th>
            </tr>
          </thead>
          <tbody id="resultBody">
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    let cachedData = [];

    // ç•¶åº•è–ªæ”¹è®Šæ™‚è‡ªå‹•è¨ˆç®—æ™‚è–ª
    document.getElementById('baseSalary').addEventListener('input', function() {
      const baseSalary = parseFloat(this.value);
      if (!isNaN(baseSalary) && baseSalary > 0) {
        const hourlyRate = (baseSalary / 240).toFixed(0);
        document.getElementById('hourlyRate').value = hourlyRate;
      }
    });

    // åˆå§‹åŒ–æ™‚è–ª
    window.onload = function() {
      const baseSalary = parseFloat(document.getElementById('baseSalary').value);
      if (!isNaN(baseSalary) && baseSalary > 0) {
        const hourlyRate = (baseSalary / 240).toFixed(0);
        document.getElementById('hourlyRate').value = hourlyRate;
      }
    };

    function calculate() {
      const baseSalary = parseFloat(document.getElementById('baseSalary').value);
      const totalMonths = parseFloat(document.getElementById('totalMonths').value);
      const holidayBonus = parseFloat(document.getElementById('holidayBonus').value) || 0;
      const performanceBonus = parseFloat(document.getElementById('performanceBonus').value) || 0;
      const otherBonus = parseFloat(document.getElementById('otherBonus').value) || 0;
      const overtimeHours = parseFloat(document.getElementById('overtimeHours').value) || 0;
      const hourlyRate = parseFloat(document.getElementById('hourlyRate').value) || (baseSalary / 240);

      if (isNaN(baseSalary) || isNaN(totalMonths) || baseSalary <= 0 || totalMonths < 12) {
        alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å€¼ï¼ç¸½å¹´è–ªæœˆæ•¸è‡³å°‘ç‚º12å€‹æœˆã€‚');
        return;
      }

      // è¨ˆç®—å„é …æ”¶å…¥
      const monthlyIncome = baseSalary * 12; // 12å€‹æœˆåº•è–ª
      const bonusMonths = totalMonths - 12; // å¹´çµ‚æœˆæ•¸
      const yearEndBonus = baseSalary * bonusMonths; // å¹´çµ‚çé‡‘
      const totalBonuses = holidayBonus + performanceBonus + otherBonus; // æ‰€æœ‰é¡å¤–çé‡‘
      const monthlyOvertime = overtimeHours * hourlyRate * 1.34; // æ¯æœˆåŠ ç­è²»ï¼ˆ1.34å€ï¼‰
      const yearlyOvertime = monthlyOvertime * 12; // å¹´åº¦åŠ ç­è²»
      const totalAnnual = monthlyIncome + yearEndBonus + totalBonuses + yearlyOvertime;

      // æ›´æ–°ç¸½è¦½
      document.getElementById('totalAnnual').textContent = '$ ' + totalAnnual.toLocaleString('zh-TW', {maximumFractionDigits: 0});
      document.getElementById('monthlySalaryTotal').textContent = monthlyIncome.toLocaleString('zh-TW', {maximumFractionDigits: 0}) + ' å…ƒ';
      document.getElementById('yearEndBonus').textContent = yearEndBonus.toLocaleString('zh-TW', {maximumFractionDigits: 0}) + ' å…ƒ';
      document.getElementById('holidayBonusDisplay').textContent = holidayBonus.toLocaleString('zh-TW', {maximumFractionDigits: 0}) + ' å…ƒ';
      document.getElementById('performanceBonusDisplay').textContent = performanceBonus.toLocaleString('zh-TW', {maximumFractionDigits: 0}) + ' å…ƒ';
      document.getElementById('otherBonusDisplay').textContent = otherBonus.toLocaleString('zh-TW', {maximumFractionDigits: 0}) + ' å…ƒ';
      document.getElementById('overtimeTotal').textContent = yearlyOvertime.toLocaleString('zh-TW', {maximumFractionDigits: 0}) + ' å…ƒ';
      document.getElementById('finalTotal').textContent = totalAnnual.toLocaleString('zh-TW', {maximumFractionDigits: 0}) + ' å…ƒ';

      // ç”Ÿæˆæ¯æœˆæ˜ç´°è¡¨
      let tableRows = '';
      cachedData = [];

      for (let month = 1; month <= 12; month++) {
        let monthBonus = 0;
        let bonusNote = '';

        // å‡è¨­å¹´çµ‚åœ¨12æœˆç™¼æ”¾
        if (month === 12 && bonusMonths > 0) {
          monthBonus = yearEndBonus;
          bonusNote = 'å¹´çµ‚';
        }

        // ä¸‰ç¯€çé‡‘åˆ†é…åœ¨2æœˆï¼ˆæ˜¥ç¯€ï¼‰ã€6æœˆï¼ˆç«¯åˆï¼‰ã€9æœˆï¼ˆä¸­ç§‹ï¼‰
        if (holidayBonus > 0) {
          if (month === 2 || month === 6 || month === 9) {
            monthBonus += holidayBonus / 3;
            bonusNote = bonusNote ? bonusNote + '+ä¸‰ç¯€' : 'ä¸‰ç¯€';
          }
        }

        // ç¸¾æ•ˆçé‡‘åœ¨12æœˆç™¼æ”¾
        if (performanceBonus > 0 && month === 12) {
          monthBonus += performanceBonus;
          bonusNote = bonusNote ? bonusNote + '+ç¸¾æ•ˆ' : 'ç¸¾æ•ˆ';
        }

        // å…¶ä»–çé‡‘åœ¨6æœˆç™¼æ”¾
        if (otherBonus > 0 && month === 6) {
          monthBonus += otherBonus;
          bonusNote = bonusNote ? bonusNote + '+å…¶ä»–' : 'å…¶ä»–';
        }

        const monthTotal = baseSalary + monthlyOvertime + monthBonus;

        cachedData.push({
          month: month,
          baseSalary: baseSalary,
          overtime: monthlyOvertime.toFixed(0),
          bonus: monthBonus.toFixed(0),
          total: monthTotal.toFixed(0)
        });

        tableRows += `
          <tr>
            <td><strong>${month}æœˆ</strong></td>
            <td>${baseSalary.toLocaleString('zh-TW')}</td>
            <td>${monthlyOvertime.toLocaleString('zh-TW', {maximumFractionDigits: 0})}</td>
            <td>${monthBonus > 0 ? monthBonus.toLocaleString('zh-TW', {maximumFractionDigits: 0}) : '-'}</td>
            <td><strong>${monthTotal.toLocaleString('zh-TW', {maximumFractionDigits: 0})}</strong></td>
          </tr>
        `;
      }

      document.getElementById('resultBody').innerHTML = tableRows;

      // é¡¯ç¤ºçµæœå€åŸŸå’Œä¸‹è¼‰æŒ‰éˆ•
      document.getElementById('result').classList.remove('hidden');
      document.getElementById('downloadBtn').classList.remove('hidden');
    }

    function downloadCSV() {
      if (cachedData.length === 0) {
        alert('è«‹å…ˆè¨ˆç®—çµæœ');
        return;
      }

      const baseSalary = parseFloat(document.getElementById('baseSalary').value);
      const totalMonths = parseFloat(document.getElementById('totalMonths').value);
      const holidayBonus = parseFloat(document.getElementById('holidayBonus').value) || 0;
      const performanceBonus = parseFloat(document.getElementById('performanceBonus').value) || 0;
      const otherBonus = parseFloat(document.getElementById('otherBonus').value) || 0;
      const overtimeHours = parseFloat(document.getElementById('overtimeHours').value) || 0;
      const hourlyRate = parseFloat(document.getElementById('hourlyRate').value);

      const monthlyIncome = baseSalary * 12;
      const bonusMonths = totalMonths - 12;
      const yearEndBonus = baseSalary * bonusMonths;
      const totalBonuses = holidayBonus + performanceBonus + otherBonus;
      const monthlyOvertime = overtimeHours * hourlyRate * 1.34;
      const yearlyOvertime = monthlyOvertime * 12;
      const totalAnnual = monthlyIncome + yearEndBonus + totalBonuses + yearlyOvertime;

      let csvContent = '\uFEFF'; // UTF-8 BOM
      csvContent += 'å¹´è–ªè¨ˆç®—çµæœ\n';
      csvContent += `æœˆåº•è–ª,${baseSalary}\n`;
      csvContent += `ç¸½å¹´è–ªæœˆæ•¸,${totalMonths}\n`;
      csvContent += `ä¸‰ç¯€çé‡‘,${holidayBonus}\n`;
      csvContent += `ç¸¾æ•ˆçé‡‘,${performanceBonus}\n`;
      csvContent += `å…¶ä»–çé‡‘,${otherBonus}\n`;
      csvContent += `æ¯æœˆåŠ ç­æ™‚æ•¸,${overtimeHours}\n`;
      csvContent += `æ™‚è–ª,${hourlyRate.toFixed(0)}\n\n`;
      csvContent += `æœˆè–ªæ”¶å…¥ï¼ˆ12å€‹æœˆï¼‰,${monthlyIncome.toFixed(0)}\n`;
      csvContent += `å¹´çµ‚çé‡‘,${yearEndBonus.toFixed(0)}\n`;
      csvContent += `ä¸‰ç¯€çé‡‘,${holidayBonus.toFixed(0)}\n`;
      csvContent += `ç¸¾æ•ˆçé‡‘,${performanceBonus.toFixed(0)}\n`;
      csvContent += `å…¶ä»–çé‡‘,${otherBonus.toFixed(0)}\n`;
      csvContent += `å¹´åº¦åŠ ç­è²»,${yearlyOvertime.toFixed(0)}\n`;
      csvContent += `å¹´åº¦ç¸½æ”¶å…¥,${totalAnnual.toFixed(0)}\n\n`;
      csvContent += 'æœˆä»½,åº•è–ªï¼ˆå…ƒï¼‰,åŠ ç­è²»ï¼ˆå…ƒï¼‰,çé‡‘ï¼ˆå…ƒï¼‰,æœˆæ”¶å…¥ï¼ˆå…ƒï¼‰\n';
      
      cachedData.forEach(row => {
        csvContent += `${row.month}æœˆ,${row.baseSalary},${row.overtime},${row.bonus},${row.total}\n`;
      });

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.setAttribute('href', URL.createObjectURL(blob));
      link.setAttribute('download', 'å¹´è–ªè¨ˆç®—çµæœ.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // æŒ‰ Enter éµä¹Ÿå¯ä»¥è¨ˆç®—
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        calculate();
      }
    });
  </script>
</body>
</html>
