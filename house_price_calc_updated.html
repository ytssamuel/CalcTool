
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æˆ¿åƒ¹æŠ˜ç®—è©¦ç®—å·¥å…·ï¼ˆé€²éšç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background: #f8f9fa;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      font-size: 1.8em;
      text-align: center;
    }
    label, select, input, button {
      display: block;
      width: 100%;
      margin: 1em 0;
      font-size: 1.1em;
    }
    input, select {
      padding: 0.5em;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      padding: 0.75em;
      font-size: 1.1em;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .result {
      margin-top: 2em;
      font-weight: bold;
      font-size: 1.2em;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1em;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5em;
      text-align: center;
    }
    .download-btn {
      background-color: #28a745;
      margin-top: 1em;
    }
    .download-btn:hover {
      background-color: #1e7e34;
    }
  </style>
</head>
<body>
  <h1>æˆ¿åƒ¹æŠ˜ç®—è©¦ç®—å·¥å…·ï¼ˆé€²éšç‰ˆï¼‰</h1>

  <label>
    ğŸ“ é¸æ“‡åœ°å€ï¼ˆè‡ªå‹•å¡«å…¥ç¸½åƒ¹ï¼‰ï¼š
    <select id="regionSelector" onchange="applyRegionPrice()">
      <option value="">-- é¸æ“‡åœ°å€ --</option>
      <option value="90">å°åŒ—å¸‚ï¼ˆ90è¬/åªï¼‰</option>
      <option value="50">æ–°ç«¹å¸‚ï¼ˆ50è¬/åªï¼‰</option>
      <option value="35">é«˜é›„å¸‚ï¼ˆ35è¬/åªï¼‰</option>
    </select>
  </label>

  <label>
    åªæ•¸:
    <input type="number" id="totalPings" placeholder="ä¾‹å¦‚ï¼š30">
  </label>

  <label>
    æˆ¿å±‹ç¸½åƒ¹ï¼ˆè¬å…ƒï¼‰:
    <input type="number" id="totalPrice" placeholder="ä¾‹å¦‚ï¼š2400">
  </label>

  <label>
    å±‹é½¡å€æ®µ:
    <select id="ageCategory">
      <option value="1.0">é å”®å±‹ï¼ˆ100%ï¼‰</option>
      <option value="0.9">10å¹´å…§æ–°å±‹ï¼ˆ90%ï¼‰</option>
      <option value="0.8">10-20å¹´å±‹ï¼ˆ80%ï¼‰</option>
      <option value="0.7">20-30å¹´å±‹ï¼ˆ70%ï¼‰</option>
      <option value="0.6">40-50å¹´å±‹ï¼ˆ60%ï¼‰</option>
    </select>
  </label>

  <label>
    ğŸ’° æˆ¿è²¸åˆ©ç‡ï¼ˆ%ï¼‰:
    <input type="number" id="interestRate" placeholder="ä¾‹å¦‚ï¼š2">
  </label>

  <label>
    è²¸æ¬¾å¹´é™ï¼ˆå¹´ï¼‰:
    <input type="number" id="loanYears" placeholder="ä¾‹å¦‚ï¼š30">
  </label>

  <button onclick="calculateBackwards()">è¨ˆç®—æŠ˜ç®—çµæœ</button>
  <button class="download-btn" onclick="downloadCSV()">ä¸‹è¼‰çµæœï¼ˆCSVï¼‰</button>

  <div class="result" id="result"></div>

  <script>
    const factors = {
      'é å”®å±‹ï¼ˆ100%ï¼‰': 1.0,
      '10å¹´å…§æ–°å±‹ï¼ˆ90%ï¼‰': 0.9,
      '10-20å¹´å±‹ï¼ˆ80%ï¼‰': 0.8,
      '20-30å¹´å±‹ï¼ˆ70%ï¼‰': 0.7,
      '40-50å¹´å±‹ï¼ˆ60%ï¼‰': 0.6
    };

    function applyRegionPrice() {
      const pings = parseFloat(document.getElementById('totalPings').value);
      const perPing = parseFloat(document.getElementById('regionSelector').value);
      if (!isNaN(pings) && !isNaN(perPing)) {
        document.getElementById('totalPrice').value = (pings * perPing).toFixed(0);
      }
    }

    let cachedData = [];

    function calculateBackwards() {
      const totalPrice = parseFloat(document.getElementById('totalPrice').value);
      const totalPings = parseFloat(document.getElementById('totalPings').value);
      const selectedFactor = parseFloat(document.getElementById('ageCategory').value);
      const rate = parseFloat(document.getElementById('interestRate').value) / 100 / 12;
      const years = parseFloat(document.getElementById('loanYears').value);
      const months = years * 12;

      if (isNaN(totalPrice) || isNaN(totalPings) || totalPings === 0) {
        document.getElementById('result').innerText = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¸½åƒ¹èˆ‡åªæ•¸';
        return;
      }

      const selectedPerPing = totalPrice / totalPings;
      const originalPerPing = selectedPerPing / selectedFactor;

      let tableRows = '';
      cachedData = [];

      for (const [label, factor] of Object.entries(factors)) {
        const adjustedPerPing = originalPerPing * factor;
        const adjustedTotalPrice = adjustedPerPing * totalPings;
        const loanAmount = adjustedTotalPrice * 10000;
        const monthlyPayment = rate === 0 ? loanAmount / months :
          loanAmount * rate / (1 - Math.pow(1 + rate, -months));
        cachedData.push({
          type: label,
          perPing: adjustedPerPing.toFixed(2),
          total: adjustedTotalPrice.toFixed(0),
          monthly: Math.round(monthlyPayment).toLocaleString()
        });
        tableRows += `<tr><td>${label}</td><td>${adjustedPerPing.toFixed(2)}</td><td>${adjustedTotalPrice.toFixed(0)}</td><td>${Math.round(monthlyPayment).toLocaleString()}</td></tr>`;
      }

      document.getElementById('result').innerHTML = `
        <table>
          <thead><tr><th>å±‹é½¡å€æ®µ</th><th>å–®åªåƒ¹ï¼ˆè¬ï¼‰</th><th>ç¸½åƒ¹ï¼ˆè¬ï¼‰</th><th>æœˆä»˜ï¼ˆä¼°ï¼‰</th></tr></thead>
          <tbody>${tableRows}</tbody>
        </table>
      `;
    }

    function downloadCSV() {
      if (cachedData.length === 0) {
        alert('è«‹å…ˆè¨ˆç®—çµæœ');
        return;
      }
      let csvContent = 'å±‹é½¡å€æ®µ,å–®åªåƒ¹æ ¼ï¼ˆè¬ï¼‰,ç¸½åƒ¹ï¼ˆè¬ï¼‰,æœˆä»˜ï¼ˆä¼°ï¼‰\n';
      cachedData.forEach(row => {
        csvContent += `${row.type},${row.perPing},${row.total},${row.monthly}\n`;
      });
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.setAttribute('href', URL.createObjectURL(blob));
      link.setAttribute('download', 'æˆ¿åƒ¹æŠ˜ç®—çµæœ.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
