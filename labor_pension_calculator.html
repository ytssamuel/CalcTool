<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å‹ä¿é€€ä¼‘é‡‘è©¦ç®—å·¥å…·</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/svg+xml" href="icon.svg">
  <link rel="stylesheet" href="common-styles.css">
  <style>
    /* é é¢ç‰¹å®šæ¨£å¼ */
    body {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .container {
      max-width: 1000px;
      background: white;
    }
    
    h1 {
      color: #333;
      text-shadow: 2px 2px 4px rgba(255,255,255,0.5);
    }
    
    .input-row {
      margin-bottom: 1.5em;
    }
    
    .label-hint {
      font-weight: normal;
      color: #666;
      font-size: 0.9em;
      margin-left: 0.5em;
    }
    
    .input-group-inline {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1em;
    }
    
    .pension-type-selector {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1em;
      margin-bottom: 1.5em;
    }
    
    .pension-type-btn {
      padding: 1em;
      border: 2px solid #ddd;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }
    
    .pension-type-btn:hover {
      border-color: #4facfe;
    }
    
    .pension-type-btn.active {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      border-color: #4facfe;
    }
    
    .pension-type-title {
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 0.3em;
    }
    
    .pension-type-desc {
      font-size: 0.85em;
      opacity: 0.8;
    }
    
    .summary-overview {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2em;
      border-radius: 10px;
      margin-bottom: 2em;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .summary-overview h2 {
      margin-top: 0;
      color: white;
      border: none;
      text-align: center;
      margin-bottom: 1.5em;
    }
    
    .big-number {
      font-size: 2.5em;
      font-weight: bold;
      text-align: center;
      margin: 0.5em 0;
      color: white;
    }
    
    .summary-subtitle {
      font-size: 1.1em;
      text-align: center;
      margin-bottom: 1.5em;
      color: white;
      opacity: 0.95;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1em;
    }
    
    .stat-box {
      background: rgba(255,255,255,0.2);
      padding: 1em;
      border-radius: 8px;
      text-align: center;
    }
    
    .stat-label {
      font-size: 0.9em;
      opacity: 0.9;
      margin-bottom: 0.5em;
    }
    
    .stat-value {
      font-size: 1.5em;
      font-weight: bold;
    }
    
    .info-card {
      background: #e3f2fd;
      padding: 1.5em;
      border-radius: 10px;
      margin-bottom: 2em;
      border-left: 4px solid #2196F3;
    }
    
    .info-card h3 {
      margin-top: 0;
      color: #1976D2;
      border: none;
    }
    
    .info-item {
      margin-bottom: 1em;
      line-height: 1.6;
    }
    
    .info-item:last-child {
      margin-bottom: 0;
    }
    
    .formula-box {
      background: #fff3e0;
      padding: 1.5em;
      border-radius: 8px;
      margin: 1.5em 0;
      border-left: 4px solid #ff9800;
    }
    
    .formula-title {
      font-weight: bold;
      color: #f57c00;
      margin-bottom: 0.8em;
      font-size: 1.1em;
    }
    
    .formula {
      font-family: 'Courier New', monospace;
      background: white;
      padding: 1em;
      border-radius: 4px;
      font-size: 1em;
      color: #333;
      line-height: 1.8;
    }
    
    .hidden {
      display: none;
    }
    
    @media (max-width: 768px) {
      .input-group-inline,
      .pension-type-selector {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .big-number {
        font-size: 2em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ’¼ å‹ä¿é€€ä¼‘é‡‘è©¦ç®—å·¥å…·</h1>

    <div class="input-group">
      <div class="info-box">
        <p>ğŸ“Œ æ ¹æ“šå°ç£å‹ä¿åˆ¶åº¦ï¼Œè©¦ç®—ä¸€æ¬¡è«‹é ˜æˆ–å¹´é‡‘çµ¦ä»˜é‡‘é¡</p>
      </div>

      <h3 style="margin-top: 1.5em; margin-bottom: 0.5em;">ğŸ¯ è«‹é ˜æ–¹å¼</h3>
      <div class="pension-type-selector">
        <div class="pension-type-btn active" onclick="setPensionType('lumpsum')">
          <div class="pension-type-title">ğŸ’° ä¸€æ¬¡è«‹é ˜</div>
          <div class="pension-type-desc">ä¸€æ¬¡é ˜å–å…¨éƒ¨é‡‘é¡</div>
        </div>
        <div class="pension-type-btn" onclick="setPensionType('annuity')">
          <div class="pension-type-title">ğŸ“… å¹´é‡‘çµ¦ä»˜</div>
          <div class="pension-type-desc">æŒ‰æœˆé ˜å–è‡³çµ‚è€</div>
        </div>
      </div>

      <div class="input-row">
        <label>
          æŠ•ä¿å¹´è³‡ï¼ˆå¹´ï¼‰:
          <span class="label-hint">åŠ ä¿ç¸½å¹´æ•¸</span>
        </label>
        <input type="number" id="yearsInsured" placeholder="ä¾‹å¦‚ï¼š25" value="25" min="0" step="0.1">
      </div>

      <div class="input-row">
        <label>
          å¹³å‡æœˆæŠ•ä¿è–ªè³‡ï¼ˆå…ƒï¼‰:
          <span class="label-hint">æœ€é«˜ 60 å€‹æœˆå¹³å‡</span>
        </label>
        <input type="number" id="avgSalary" placeholder="ä¾‹å¦‚ï¼š45800" value="45800" min="0">
      </div>

      <div id="annuityOptions" class="hidden">
        <div class="input-group-inline">
          <div class="input-row">
            <label>
              é ä¼°é€€ä¼‘å¹´é½¡:
              <span class="label-hint">é–‹å§‹è«‹é ˜å¹´é½¡</span>
            </label>
            <input type="number" id="retirementAge" placeholder="ä¾‹å¦‚ï¼š65" value="65" min="50" max="75">
          </div>
          
          <div class="input-row">
            <label>
              é ä¼°å¹³å‡é¤˜å‘½:
              <span class="label-hint">é è¨ˆé ˜å–å¹´æ•¸</span>
            </label>
            <input type="number" id="lifeExpectancy" placeholder="ä¾‹å¦‚ï¼š20" value="20" min="5" max="40">
          </div>
        </div>
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick="calculate()">é–‹å§‹è©¦ç®—</button>
        <button class="btn-secondary hidden" id="downloadBtn" onclick="downloadCSV()">ä¸‹è¼‰çµæœï¼ˆCSVï¼‰</button>
      </div>
    </div>

    <div class="hidden" id="result">
      <div class="summary-overview">
        <h2 id="resultTitle">ğŸ’° è©¦ç®—çµæœ</h2>
        <div class="big-number" id="totalAmount">-</div>
        <div class="summary-subtitle" id="amountSubtitle">-</div>
        
        <div class="stats-grid" id="statsGrid"></div>
      </div>

      <div class="formula-box">
        <div class="formula-title" id="formulaTitle">ğŸ“ è¨ˆç®—å…¬å¼</div>
        <div class="formula" id="formulaContent"></div>
      </div>

      <div class="info-card">
        <h3>â„¹ï¸ å‹ä¿è€å¹´çµ¦ä»˜èªªæ˜</h3>
        <div class="info-item">
          <strong>ğŸ“‹ è«‹é ˜è³‡æ ¼ï¼š</strong><br>
          â€¢ å¹´æ»¿ 60 æ­²ï¼Œä¿éšªå¹´è³‡åˆè¨ˆæ»¿ 15 å¹´ï¼Œè¾¦ç†é›¢è·é€€ä¿è€…<br>
          â€¢ æ“”ä»»å…·æœ‰å±éšªã€å …å¼·é«”åŠ›ç­‰ç‰¹æ®Šæ€§è³ªä¹‹å·¥ä½œåˆè¨ˆæ»¿ 15 å¹´ï¼Œå¹´æ»¿ 55 æ­²ï¼Œè¾¦ç†é›¢è·é€€ä¿è€…
        </div>
        <div class="info-item">
          <strong>ğŸ’° ä¸€æ¬¡è«‹é ˜ï¼š</strong><br>
          â€¢ å¹´è³‡æœªæ»¿ 1 å¹´è€…ï¼ŒæŒ‰å¯¦éš›åŠ ä¿æœˆæ•¸ç™¼çµ¦<br>
          â€¢ å¹´è³‡æ»¿ 1 å¹´è€…ï¼Œæ¯æ»¿ 1 å¹´çµ¦ä»˜ 1 å€‹æœˆï¼Œæœ€é«˜ä»¥ 45 å€‹æœˆç‚ºé™<br>
          â€¢ è¶…é 60 æ­²ä»¥å¾Œä¹‹ä¿éšªå¹´è³‡ï¼Œæœ€å¤šä»¥ 5 å¹´è¨ˆ
        </div>
        <div class="info-item">
          <strong>ğŸ“… å¹´é‡‘çµ¦ä»˜ï¼š</strong><br>
          â€¢ ä¿éšªå¹´è³‡åˆè¨ˆæ¯æ»¿ 1 å¹´ï¼ŒæŒ‰å¹³å‡æœˆæŠ•ä¿è–ªè³‡ Ã— 0.775% è¨ˆç®—<br>
          â€¢ è¶…é 15 å¹´éƒ¨åˆ†ï¼ŒæŒ‰å¹³å‡æœˆæŠ•ä¿è–ªè³‡ Ã— 1.55% è¨ˆç®—<br>
          â€¢ 60 æ­²ä»¥å‰è«‹é ˜ï¼Œæ¯æå‰ 1 å¹´æ¸›çµ¦ 4%ï¼Œæœ€å¤šæ¸›çµ¦ 20%<br>
          â€¢ 65 æ­²ä»¥å¾Œè«‹é ˜ï¼Œæ¯å»¶å¾Œ 1 å¹´å¢çµ¦ 4%ï¼Œæœ€å¤šå¢çµ¦ 20%
        </div>
        <div class="info-item">
          <strong>ğŸ“Š å¹³å‡æœˆæŠ•ä¿è–ªè³‡ï¼š</strong><br>
          â€¢ æŒ‰åŠ ä¿æœŸé–“æœ€é«˜ 60 å€‹æœˆä¹‹æœˆæŠ•ä¿è–ªè³‡å¹³å‡è¨ˆç®—<br>
          â€¢ 2009å¹´1æœˆ1æ—¥å‰æœ‰ä¿éšªå¹´è³‡è€…ï¼Œå¾—é¸æ“‡ä»¥åŠ ä¿æœŸé–“æœ€é«˜ 60 å€‹æœˆæˆ–é€€ä¿ç•¶æœˆèµ·å‰ 3 å¹´å¹³å‡è¨ˆç®—
        </div>
      </div>
    </div>
  </div>

  <script>
    let pensionType = 'lumpsum';
    let cachedData = {};

    function setPensionType(type) {
      pensionType = type;
      
      // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
      document.querySelectorAll('.pension-type-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.closest('.pension-type-btn').classList.add('active');
      
      // é¡¯ç¤º/éš±è—å¹´é‡‘é¸é …
      if (type === 'annuity') {
        document.getElementById('annuityOptions').classList.remove('hidden');
      } else {
        document.getElementById('annuityOptions').classList.add('hidden');
      }
    }

    function calculate() {
      const yearsInsured = parseFloat(document.getElementById('yearsInsured').value);
      const avgSalary = parseFloat(document.getElementById('avgSalary').value);

      if (isNaN(yearsInsured) || isNaN(avgSalary) || yearsInsured < 0 || avgSalary < 0) {
        alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å€¼ï¼');
        return;
      }

      if (yearsInsured < 15 && pensionType === 'annuity') {
        alert('å¹´é‡‘çµ¦ä»˜éœ€å¹´è³‡æ»¿ 15 å¹´ï¼Œè«‹æ”¹é¸ä¸€æ¬¡è«‹é ˜æˆ–å¢åŠ å¹´è³‡ï¼');
        return;
      }

      if (pensionType === 'lumpsum') {
        calculateLumpSum(yearsInsured, avgSalary);
      } else {
        const retirementAge = parseInt(document.getElementById('retirementAge').value);
        const lifeExpectancy = parseInt(document.getElementById('lifeExpectancy').value);
        
        if (isNaN(retirementAge) || isNaN(lifeExpectancy)) {
          alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é€€ä¼‘å¹´é½¡èˆ‡é ä¼°é¤˜å‘½ï¼');
          return;
        }
        
        calculateAnnuity(yearsInsured, avgSalary, retirementAge, lifeExpectancy);
      }

      // é¡¯ç¤ºçµæœ
      document.getElementById('result').classList.remove('hidden');
      document.getElementById('downloadBtn').classList.remove('hidden');
    }

    function calculateLumpSum(years, salary) {
      // ä¸€æ¬¡è«‹é ˜ï¼šå¹´è³‡æ»¿1å¹´çµ¦ä»˜1å€‹æœˆï¼Œæœ€é«˜45å€‹æœˆ
      let months = Math.floor(years);
      
      // è¶…é45å€‹æœˆä»¥45å€‹æœˆè¨ˆ
      if (months > 45) {
        months = 45;
      }
      
      // è¨ˆç®—çµ¦ä»˜é‡‘é¡
      const totalAmount = salary * months;
      
      // å„²å­˜è³‡æ–™
      cachedData = {
        type: 'ä¸€æ¬¡è«‹é ˜',
        years: years,
        salary: salary,
        months: months,
        totalAmount: totalAmount
      };
      
      // æ›´æ–°é¡¯ç¤º
      document.getElementById('resultTitle').textContent = 'ğŸ’° ä¸€æ¬¡è«‹é ˜è€å¹´çµ¦ä»˜';
      document.getElementById('totalAmount').textContent = '$ ' + Math.round(totalAmount).toLocaleString('zh-TW');
      document.getElementById('amountSubtitle').textContent = 'å…ƒï¼ˆä¸€æ¬¡é ˜å–ï¼‰';
      
      // çµ±è¨ˆè³‡è¨Š
      let statsHTML = `
        <div class="stat-box">
          <div class="stat-label">æŠ•ä¿å¹´è³‡</div>
          <div class="stat-value">${years.toFixed(1)} å¹´</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">çµ¦ä»˜æœˆæ•¸</div>
          <div class="stat-value">${months} å€‹æœˆ</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">å¹³å‡æœˆæŠ•ä¿è–ªè³‡</div>
          <div class="stat-value">${salary.toLocaleString('zh-TW')} å…ƒ</div>
        </div>
      `;
      document.getElementById('statsGrid').innerHTML = statsHTML;
      
      // å…¬å¼èªªæ˜
      document.getElementById('formulaTitle').textContent = 'ğŸ“ ä¸€æ¬¡è«‹é ˜è¨ˆç®—å…¬å¼';
      document.getElementById('formulaContent').innerHTML = `
        çµ¦ä»˜é‡‘é¡ = å¹³å‡æœˆæŠ•ä¿è–ªè³‡ Ã— çµ¦ä»˜æœˆæ•¸<br>
        çµ¦ä»˜æœˆæ•¸ = MIN(æŠ•ä¿å¹´è³‡æ•´æ•¸, 45)<br>
        <br>
        <strong>æœ¬æ¬¡è©¦ç®—ï¼š</strong><br>
        çµ¦ä»˜é‡‘é¡ = ${salary.toLocaleString('zh-TW')} Ã— ${months}<br>
        = <strong>${Math.round(totalAmount).toLocaleString('zh-TW')} å…ƒ</strong>
      `;
    }

    function calculateAnnuity(years, salary, retirementAge, lifeYears) {
      // å¹´é‡‘çµ¦ä»˜ï¼šå‰15å¹´0.775%ï¼Œè¶…é15å¹´1.55%
      let rate1 = 0.00775; // å‰15å¹´
      let rate2 = 0.0155;  // è¶…é15å¹´
      
      let monthlyAmount = 0;
      
      if (years <= 15) {
        monthlyAmount = salary * years * rate1;
      } else {
        monthlyAmount = salary * 15 * rate1 + salary * (years - 15) * rate2;
      }
      
      // èª¿æ•´ä¿‚æ•¸ï¼ˆæå‰æˆ–å»¶å¾Œè«‹é ˜ï¼‰
      let adjustmentFactor = 1.0;
      let adjustmentNote = '';
      
      if (retirementAge < 60) {
        const earlyYears = 60 - retirementAge;
        adjustmentFactor = Math.max(0.8, 1 - earlyYears * 0.04); // æ¯å¹´æ¸›4%ï¼Œæœ€å¤šæ¸›20%
        adjustmentNote = `ï¼ˆæå‰ ${earlyYears} å¹´è«‹é ˜ï¼Œæ¸›çµ¦ ${((1 - adjustmentFactor) * 100).toFixed(0)}%ï¼‰`;
      } else if (retirementAge > 65) {
        const delayYears = retirementAge - 65;
        adjustmentFactor = Math.min(1.2, 1 + delayYears * 0.04); // æ¯å¹´å¢4%ï¼Œæœ€å¤šå¢20%
        adjustmentNote = `ï¼ˆå»¶å¾Œ ${delayYears} å¹´è«‹é ˜ï¼Œå¢çµ¦ ${((adjustmentFactor - 1) * 100).toFixed(0)}%ï¼‰`;
      }
      
      monthlyAmount = monthlyAmount * adjustmentFactor;
      
      // è¨ˆç®—å¹´åº¦ç¸½é¡å’Œçµ‚èº«ç¸½é¡
      const annualAmount = monthlyAmount * 12;
      const lifetimeTotal = monthlyAmount * 12 * lifeYears;
      
      // å„²å­˜è³‡æ–™
      cachedData = {
        type: 'å¹´é‡‘çµ¦ä»˜',
        years: years,
        salary: salary,
        retirementAge: retirementAge,
        monthlyAmount: monthlyAmount,
        annualAmount: annualAmount,
        lifeYears: lifeYears,
        lifetimeTotal: lifetimeTotal,
        adjustmentFactor: adjustmentFactor,
        adjustmentNote: adjustmentNote
      };
      
      // æ›´æ–°é¡¯ç¤º
      document.getElementById('resultTitle').textContent = 'ğŸ“… è€å¹´å¹´é‡‘çµ¦ä»˜';
      document.getElementById('totalAmount').textContent = '$ ' + Math.round(monthlyAmount).toLocaleString('zh-TW');
      document.getElementById('amountSubtitle').textContent = 'å…ƒ/æœˆ ' + adjustmentNote;
      
      // çµ±è¨ˆè³‡è¨Š
      let statsHTML = `
        <div class="stat-box">
          <div class="stat-label">æŠ•ä¿å¹´è³‡</div>
          <div class="stat-value">${years.toFixed(1)} å¹´</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">å¹´åº¦ç¸½é¡</div>
          <div class="stat-value">${Math.round(annualAmount).toLocaleString('zh-TW')} å…ƒ</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">é ä¼°é¤˜å‘½</div>
          <div class="stat-value">${lifeYears} å¹´</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">çµ‚èº«é ä¼°ç¸½é¡</div>
          <div class="stat-value">${Math.round(lifetimeTotal).toLocaleString('zh-TW')} å…ƒ</div>
        </div>
      `;
      document.getElementById('statsGrid').innerHTML = statsHTML;
      
      // å…¬å¼èªªæ˜
      document.getElementById('formulaTitle').textContent = 'ğŸ“ å¹´é‡‘çµ¦ä»˜è¨ˆç®—å…¬å¼';
      
      let formula1 = '';
      if (years <= 15) {
        formula1 = `æœˆé ˜é‡‘é¡ = ${salary.toLocaleString('zh-TW')} Ã— ${years.toFixed(1)} Ã— 0.775%<br>
                    = ${(salary * years * 0.00775).toFixed(0)} å…ƒ`;
      } else {
        formula1 = `æœˆé ˜é‡‘é¡ = ${salary.toLocaleString('zh-TW')} Ã— 15 Ã— 0.775% + ${salary.toLocaleString('zh-TW')} Ã— ${(years - 15).toFixed(1)} Ã— 1.55%<br>
                    = ${(salary * 15 * 0.00775).toFixed(0)} + ${(salary * (years - 15) * 0.0155).toFixed(0)}<br>
                    = ${(salary * years * 0.00775 + salary * (years > 15 ? years - 15 : 0) * 0.0155).toFixed(0)} å…ƒ`;
      }
      
      document.getElementById('formulaContent').innerHTML = `
        <strong>åŸºæœ¬å…¬å¼ï¼š</strong><br>
        â€¢ å‰ 15 å¹´ï¼šå¹³å‡æœˆæŠ•ä¿è–ªè³‡ Ã— å¹´è³‡ Ã— 0.775%<br>
        â€¢ è¶…é 15 å¹´ï¼šå¹³å‡æœˆæŠ•ä¿è–ªè³‡ Ã— å¹´è³‡ Ã— 1.55%<br>
        <br>
        <strong>æœ¬æ¬¡è©¦ç®—ï¼š</strong><br>
        ${formula1}<br>
        ${adjustmentFactor !== 1.0 ? `<br>èª¿æ•´å¾Œæœˆé ˜é‡‘é¡ = ${(salary * years * 0.00775 + salary * (years > 15 ? years - 15 : 0) * 0.0155).toFixed(0)} Ã— ${adjustmentFactor.toFixed(2)}<br>` : ''}
        = <strong>${Math.round(monthlyAmount).toLocaleString('zh-TW')} å…ƒ/æœˆ</strong>
      `;
    }

    function downloadCSV() {
      if (!cachedData || Object.keys(cachedData).length === 0) {
        alert('è«‹å…ˆè¨ˆç®—çµæœ');
        return;
      }

      let csvContent = '\uFEFF'; // UTF-8 BOM
      csvContent += 'å‹ä¿é€€ä¼‘é‡‘è©¦ç®—çµæœ\n';
      csvContent += `è«‹é ˜æ–¹å¼,${cachedData.type}\n`;
      csvContent += `æŠ•ä¿å¹´è³‡,${cachedData.years} å¹´\n`;
      csvContent += `å¹³å‡æœˆæŠ•ä¿è–ªè³‡,${cachedData.salary} å…ƒ\n\n`;
      
      if (cachedData.type === 'ä¸€æ¬¡è«‹é ˜') {
        csvContent += `çµ¦ä»˜æœˆæ•¸,${cachedData.months} å€‹æœˆ\n`;
        csvContent += `çµ¦ä»˜ç¸½é¡,${Math.round(cachedData.totalAmount)} å…ƒ\n`;
      } else {
        csvContent += `é€€ä¼‘å¹´é½¡,${cachedData.retirementAge} æ­²\n`;
        csvContent += `æ¯æœˆå¹´é‡‘,${Math.round(cachedData.monthlyAmount)} å…ƒ\n`;
        csvContent += `å¹´åº¦ç¸½é¡,${Math.round(cachedData.annualAmount)} å…ƒ\n`;
        csvContent += `é ä¼°é¤˜å‘½,${cachedData.lifeYears} å¹´\n`;
        csvContent += `çµ‚èº«é ä¼°ç¸½é¡,${Math.round(cachedData.lifetimeTotal)} å…ƒ\n`;
        if (cachedData.adjustmentNote) {
          csvContent += `å‚™è¨»,${cachedData.adjustmentNote}\n`;
        }
      }

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.setAttribute('href', URL.createObjectURL(blob));
      link.setAttribute('download', 'å‹ä¿é€€ä¼‘é‡‘è©¦ç®—çµæœ.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // æŒ‰ Enter éµä¹Ÿå¯ä»¥è¨ˆç®—
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        calculate();
      }
    });
  </script>
</body>
</html>
