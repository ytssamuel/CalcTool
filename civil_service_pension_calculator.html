<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å…¬ä¿é€€ä¼‘é‡‘è©¦ç®—å·¥å…·</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/svg+xml" href="icon.svg">
  <link rel="stylesheet" href="common-styles.css">
  <style>
    /* é é¢ç‰¹å®šæ¨£å¼ */
    .container {
      max-width: 900px;
    }
    
    body {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    /* è¦†è“‹ common-styles.css çš„ç™½è‰²èƒŒæ™¯ */
    .input-group {
      background: rgba(255, 255, 255, 0.15) !important;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    .info-box {
      background: rgba(255, 255, 255, 0.85) !important;
      border-left: 4px solid #0077b6;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .info-box p {
      color: #023e8a !important;
      text-shadow: none;
      font-weight: 500;
    }
    
    .mode-selector {
      display: flex;
      gap: 1em;
      margin-bottom: 2em;
    }
    
    .mode-btn {
      flex: 1;
      padding: 1em;
      border: 2px solid rgba(255,255,255,0.8);
      background: rgba(255,255,255,0.7);
      color: #0077b6;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1em;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .mode-btn:hover {
      background: rgba(255,255,255,0.85);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .mode-btn.active {
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(230,248,255,0.95) 100%);
      color: #0077b6;
      border-color: rgba(255,255,255,0.8);
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1em;
      margin: 2em 0;
    }
    
    .stat-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(230,248,255,0.95) 100%);
      padding: 1.5em;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.6);
    }
    
    .stat-label {
      color: #666;
      font-size: 0.9em;
      margin-bottom: 0.5em;
    }
    
    .stat-value {
      color: #00b4d8;
      font-size: 1.8em;
      font-weight: bold;
    }
    
    .formula-box {
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(240,249,255,0.95) 100%);
      padding: 1.5em;
      border-radius: 10px;
      margin: 1.5em 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.6);
    }
    
    .formula-box h4 {
      color: #0077b6;
      margin-top: 0;
    }
    
    .formula {
      background: linear-gradient(135deg, #e7f6fd 0%, #d4f1f9 100%);
      padding: 1em;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      margin: 1em 0;
      overflow-x: auto;
      border-left: 4px solid #0096c7;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
    }
    
    .info-section {
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(240,249,255,0.95) 100%);
      padding: 1.5em;
      border-radius: 10px;
      margin: 1.5em 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.6);
    }
    
    .info-section h4 {
      color: #0096c7;
      margin-top: 0;
    }
    
    .info-section ul {
      margin: 0.5em 0;
      padding-left: 1.5em;
    }
    
    .info-section li {
      margin: 0.5em 0;
      color: #555;
    }
    
    .highlight {
      background: #caf0f8;
      padding: 0.2em 0.5em;
      border-radius: 3px;
      font-weight: bold;
      color: #023e8a;
    }
    
    .warning-box {
      background: linear-gradient(135deg, #caf0f8 0%, #ade8f4 100%);
      border-left: 4px solid #0077b6;
      padding: 1em;
      margin: 1em 0;
      border-radius: 5px;
      color: #023e8a;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    
    @media (max-width: 768px) {
      .mode-selector {
        flex-direction: column;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ›ï¸ å…¬ä¿é€€ä¼‘é‡‘è©¦ç®—å·¥å…·</h1>

    <div class="input-group">
      <div class="info-box">
        <p>ğŸ“Œ æ ¹æ“šå°ç£å…¬å‹™äººå“¡ä¿éšªåˆ¶åº¦ï¼Œè©¦ç®—é¤Šè€çµ¦ä»˜é‡‘é¡</p>
        <p>é©ç”¨å°è±¡ï¼šå…¬å‹™äººå“¡ã€å…¬ç«‹å­¸æ ¡æ•™è·å“¡ç­‰</p>
      </div>

      <div class="mode-selector">
        <button class="mode-btn active" onclick="switchMode('lump')">
          ğŸ’° ä¸€æ¬¡é¤Šè€çµ¦ä»˜
        </button>
        <button class="mode-btn" onclick="switchMode('annuity')">
          ğŸ“… é¤Šè€å¹´é‡‘çµ¦ä»˜
        </button>
      </div>

      <div class="input-row">
        <label>
          ä¿éšªå¹´è³‡ï¼ˆå¹´ï¼‰:
          <span class="label-hint">å¯¦éš›ç¹³ç´å…¬ä¿çš„å¹´æ•¸</span>
        </label>
        <input type="number" id="yearsOfService" placeholder="ä¾‹å¦‚ï¼š30" value="30" step="0.5" min="0">
      </div>

      <div class="input-row">
        <label>
          æœ€å¾Œåœ¨è·å¹³å‡è–ªè³‡ï¼ˆå…ƒ/æœˆï¼‰:
          <span class="label-hint">é€€ä¼‘å‰æœ€å¾Œåœ¨è·15å¹´å¹³å‡æœˆè–ªè³‡</span>
        </label>
        <input type="number" id="avgSalary" placeholder="ä¾‹å¦‚ï¼š60000" value="60000" step="1000">
      </div>

      <div class="input-row" id="ageRow">
        <label>
          é€€ä¼‘å¹´é½¡ï¼ˆæ­²ï¼‰:
          <span class="label-hint">å¯¦éš›é€€ä¼‘æ™‚çš„å¹´é½¡</span>
        </label>
        <input type="number" id="retirementAge" placeholder="ä¾‹å¦‚ï¼š60" value="60" min="50" max="70">
      </div>

      <div class="input-row" id="lifeExpectancyRow" style="display: none;">
        <label>
          é ä¼°é¤˜å‘½ï¼ˆå¹´ï¼‰:
          <span class="label-hint">ç”¨æ–¼è¨ˆç®—å¹´é‡‘ç¸½é¡</span>
        </label>
        <input type="number" id="lifeExpectancy" placeholder="ä¾‹å¦‚ï¼š25" value="25" min="10" max="50">
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick="calculate()">é–‹å§‹è¨ˆç®—</button>
        <button class="btn-secondary hidden" id="downloadBtn" onclick="downloadCSV()">ä¸‹è¼‰çµæœï¼ˆCSVï¼‰</button>
      </div>
    </div>

    <div class="hidden" id="result">
      <div class="stats-grid" id="statsGrid"></div>
      <div id="formulaSection"></div>
      <div id="infoSection"></div>
    </div>
  </div>

  <script>
    let currentMode = 'lump'; // 'lump' or 'annuity'
    let cachedResult = null;

    function switchMode(mode) {
      currentMode = mode;
      
      // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
      document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // é¡¯ç¤º/éš±è—ç›¸é—œè¼¸å…¥æ¬„ä½
      if (mode === 'annuity') {
        document.getElementById('ageRow').style.display = 'block';
        document.getElementById('lifeExpectancyRow').style.display = 'block';
      } else {
        document.getElementById('ageRow').style.display = 'none';
        document.getElementById('lifeExpectancyRow').style.display = 'none';
      }
      
      // å¦‚æœå·²æœ‰çµæœï¼Œé‡æ–°è¨ˆç®—
      if (cachedResult) {
        calculate();
      }
    }

    function calculate() {
      const yearsOfService = parseFloat(document.getElementById('yearsOfService').value);
      const avgSalary = parseFloat(document.getElementById('avgSalary').value);
      const retirementAge = parseInt(document.getElementById('retirementAge').value);
      const lifeExpectancy = parseInt(document.getElementById('lifeExpectancy').value);

      if (isNaN(yearsOfService) || isNaN(avgSalary)) {
        alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å€¼ï¼');
        return;
      }

      if (currentMode === 'annuity' && (isNaN(retirementAge) || isNaN(lifeExpectancy))) {
        alert('è«‹è¼¸å…¥é€€ä¼‘å¹´é½¡å’Œé ä¼°é¤˜å‘½ï¼');
        return;
      }

      let result = {};
      
      if (currentMode === 'lump') {
        result = calculateLumpSum(yearsOfService, avgSalary);
      } else {
        result = calculateAnnuity(yearsOfService, avgSalary, retirementAge, lifeExpectancy);
      }
      
      cachedResult = result;
      displayResult(result);
      
      document.getElementById('result').classList.remove('hidden');
      document.getElementById('downloadBtn').classList.remove('hidden');
    }

    function calculateLumpSum(years, salary) {
      // å…¬ä¿ä¸€æ¬¡é¤Šè€çµ¦ä»˜ï¼šæŒ‰æœˆæ•¸çµ¦ä»˜
      // 15å¹´ä»¥ä¸‹ï¼šæ¯å¹´çµ¦1.2å€‹æœˆ
      // 16-20å¹´ï¼šæ¯å¹´çµ¦1.4å€‹æœˆ
      // 21-30å¹´ï¼šæ¯å¹´çµ¦1.6å€‹æœˆ  
      // 31å¹´ä»¥ä¸Šï¼šæ¯å¹´çµ¦1.8å€‹æœˆ
      // æœ€é«˜ä¸Šé™ï¼š36å€‹æœˆ
      
      let months = 0;
      let breakdown = [];
      
      if (years <= 15) {
        months = years * 1.2;
        breakdown.push(`${years.toFixed(1)}å¹´ Ã— 1.2å€‹æœˆ = ${months.toFixed(1)}å€‹æœˆ`);
      } else if (years <= 20) {
        const part1 = 15 * 1.2;
        const part2 = (years - 15) * 1.4;
        months = part1 + part2;
        breakdown.push(`å‰15å¹´ï¼š15 Ã— 1.2 = ${part1.toFixed(1)}å€‹æœˆ`);
        breakdown.push(`16-${years.toFixed(1)}å¹´ï¼š${(years - 15).toFixed(1)} Ã— 1.4 = ${part2.toFixed(1)}å€‹æœˆ`);
      } else if (years <= 30) {
        const part1 = 15 * 1.2;
        const part2 = 5 * 1.4;
        const part3 = (years - 20) * 1.6;
        months = part1 + part2 + part3;
        breakdown.push(`å‰15å¹´ï¼š15 Ã— 1.2 = ${part1.toFixed(1)}å€‹æœˆ`);
        breakdown.push(`16-20å¹´ï¼š5 Ã— 1.4 = ${part2.toFixed(1)}å€‹æœˆ`);
        breakdown.push(`21-${years.toFixed(1)}å¹´ï¼š${(years - 20).toFixed(1)} Ã— 1.6 = ${part3.toFixed(1)}å€‹æœˆ`);
      } else {
        const part1 = 15 * 1.2;
        const part2 = 5 * 1.4;
        const part3 = 10 * 1.6;
        const part4 = (years - 30) * 1.8;
        months = part1 + part2 + part3 + part4;
        breakdown.push(`å‰15å¹´ï¼š15 Ã— 1.2 = ${part1.toFixed(1)}å€‹æœˆ`);
        breakdown.push(`16-20å¹´ï¼š5 Ã— 1.4 = ${part2.toFixed(1)}å€‹æœˆ`);
        breakdown.push(`21-30å¹´ï¼š10 Ã— 1.6 = ${part3.toFixed(1)}å€‹æœˆ`);
        breakdown.push(`31-${years.toFixed(1)}å¹´ï¼š${(years - 30).toFixed(1)} Ã— 1.8 = ${part4.toFixed(1)}å€‹æœˆ`);
      }
      
      // æœ€é«˜ä¸Šé™36å€‹æœˆ
      if (months > 36) {
        breakdown.push(`âš ï¸ è¶…éä¸Šé™ï¼Œä»¥36å€‹æœˆè¨ˆç®—`);
        months = 36;
      }
      
      const totalAmount = salary * months;
      
      return {
        mode: 'lump',
        years: years,
        salary: salary,
        months: months.toFixed(1),
        breakdown: breakdown,
        totalAmount: totalAmount,
        monthlyAmount: null
      };
    }

    function calculateAnnuity(years, salary, age, lifeExpectancy) {
      // å…¬ä¿é¤Šè€å¹´é‡‘çµ¦ä»˜ï¼šæŒ‰æœˆé ˜å–
      // ä¿éšªå¹´è³‡Ã—1.3%Ã—å¹³å‡æœˆè–ªè³‡
      // æå‰é€€ä¼‘ï¼ˆæœªæ»¿65æ­²ï¼‰ï¼šæ¯æå‰1å¹´æ¸›4%ï¼Œæœ€å¤šæ¸›20%
      // å»¶å¾Œé€€ä¼‘ï¼ˆè¶…é65æ­²ï¼‰ï¼šæ¯å»¶å¾Œ1å¹´å¢4%ï¼Œæœ€å¤šå¢20%
      
      const baseRate = 0.013; // 1.3%
      let monthlyBase = salary * years * baseRate;
      
      // è¨ˆç®—å¹´é½¡èª¿æ•´
      let ageAdjustment = 1.0;
      let adjustmentNote = '';
      
      if (age < 65) {
        const yearsEarly = 65 - age;
        const reduction = Math.min(yearsEarly * 0.04, 0.20);
        ageAdjustment = 1 - reduction;
        adjustmentNote = `æå‰${yearsEarly}å¹´é€€ä¼‘ï¼Œæ¸›çµ¦${(reduction * 100).toFixed(0)}%`;
      } else if (age > 65) {
        const yearsLate = age - 65;
        const increase = Math.min(yearsLate * 0.04, 0.20);
        ageAdjustment = 1 + increase;
        adjustmentNote = `å»¶å¾Œ${yearsLate}å¹´é€€ä¼‘ï¼Œå¢çµ¦${(increase * 100).toFixed(0)}%`;
      } else {
        adjustmentNote = '65æ­²é€€ä¼‘ï¼Œç„¡èª¿æ•´';
      }
      
      const monthlyAmount = monthlyBase * ageAdjustment;
      const annualAmount = monthlyAmount * 12;
      const lifetimeTotal = monthlyAmount * 12 * lifeExpectancy;
      
      return {
        mode: 'annuity',
        years: years,
        salary: salary,
        age: age,
        lifeExpectancy: lifeExpectancy,
        baseRate: (baseRate * 100).toFixed(1),
        monthlyBase: monthlyBase,
        ageAdjustment: ageAdjustment,
        adjustmentNote: adjustmentNote,
        monthlyAmount: monthlyAmount,
        annualAmount: annualAmount,
        lifetimeTotal: lifetimeTotal
      };
    }

    function displayResult(result) {
      const statsGrid = document.getElementById('statsGrid');
      const formulaSection = document.getElementById('formulaSection');
      const infoSection = document.getElementById('infoSection');
      
      if (result.mode === 'lump') {
        // ä¸€æ¬¡é¤Šè€çµ¦ä»˜
        statsGrid.innerHTML = `
          <div class="stat-card">
            <div class="stat-label">çµ¦ä»˜æœˆæ•¸</div>
            <div class="stat-value">${result.months}</div>
            <div class="stat-label">å€‹æœˆ</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">ä¸€æ¬¡é ˜å–ç¸½é¡</div>
            <div class="stat-value">${result.totalAmount.toLocaleString()}</div>
            <div class="stat-label">å…ƒ</div>
          </div>
        `;
        
        formulaSection.innerHTML = `
          <div class="formula-box">
            <h4>ğŸ“ è¨ˆç®—å…¬å¼</h4>
            <div class="formula">
              ä¸€æ¬¡é¤Šè€çµ¦ä»˜ = å¹³å‡æœˆè–ªè³‡ Ã— çµ¦ä»˜æœˆæ•¸<br>
              = ${result.salary.toLocaleString()} å…ƒ Ã— ${result.months} å€‹æœˆ<br>
              = ${result.totalAmount.toLocaleString()} å…ƒ
            </div>
            <h4>çµ¦ä»˜æœˆæ•¸è¨ˆç®—æ–¹å¼ï¼š</h4>
            <ul style="margin: 0.5em 0; color: #555;">
              ${result.breakdown.map(item => `<li>${item}</li>`).join('')}
            </ul>
            <div class="warning-box">
              âš ï¸ çµ¦ä»˜æœˆæ•¸ä¸Šé™ç‚º <span class="highlight">36å€‹æœˆ</span>
            </div>
          </div>
        `;
        
        infoSection.innerHTML = `
          <div class="info-section">
            <h4>ğŸ“‹ å…¬ä¿é¤Šè€çµ¦ä»˜èªªæ˜</h4>
            <ul>
              <li><strong>çµ¦ä»˜æ¨™æº–ï¼š</strong>ä¾ä¿éšªå¹´è³‡è¨ˆç®—çµ¦ä»˜æœˆæ•¸</li>
              <li>15å¹´ä»¥ä¸‹ï¼šæ¯å¹´çµ¦ <span class="highlight">1.2å€‹æœˆ</span></li>
              <li>16-20å¹´ï¼šæ¯å¹´çµ¦ <span class="highlight">1.4å€‹æœˆ</span></li>
              <li>21-30å¹´ï¼šæ¯å¹´çµ¦ <span class="highlight">1.6å€‹æœˆ</span></li>
              <li>31å¹´ä»¥ä¸Šï¼šæ¯å¹´çµ¦ <span class="highlight">1.8å€‹æœˆ</span></li>
              <li><strong>çµ¦ä»˜ä¸Šé™ï¼š</strong>æœ€é«˜36å€‹æœˆ</li>
              <li><strong>å¹³å‡è–ªè³‡ï¼š</strong>é€€ä¼‘å‰æœ€å¾Œåœ¨è·15å¹´å¹³å‡æœˆæŠ•ä¿è–ªè³‡</li>
            </ul>
          </div>
        `;
      } else {
        // é¤Šè€å¹´é‡‘çµ¦ä»˜
        statsGrid.innerHTML = `
          <div class="stat-card">
            <div class="stat-label">æ¯æœˆå¹´é‡‘</div>
            <div class="stat-value">${Math.round(result.monthlyAmount).toLocaleString()}</div>
            <div class="stat-label">å…ƒ/æœˆ</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">æ¯å¹´å¹´é‡‘</div>
            <div class="stat-value">${Math.round(result.annualAmount).toLocaleString()}</div>
            <div class="stat-label">å…ƒ/å¹´</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">é ä¼°çµ‚èº«ç¸½é¡</div>
            <div class="stat-value">${Math.round(result.lifetimeTotal / 10000).toLocaleString()}</div>
            <div class="stat-label">è¬å…ƒ</div>
          </div>
        `;
        
        formulaSection.innerHTML = `
          <div class="formula-box">
            <h4>ğŸ“ è¨ˆç®—å…¬å¼</h4>
            <div class="formula">
              æ¯æœˆå¹´é‡‘ = å¹³å‡æœˆè–ªè³‡ Ã— ä¿éšªå¹´è³‡ Ã— 1.3% Ã— å¹´é½¡èª¿æ•´ä¿‚æ•¸<br>
              = ${result.salary.toLocaleString()} Ã— ${result.years} Ã— 1.3% Ã— ${result.ageAdjustment.toFixed(2)}<br>
              = ${Math.round(result.monthlyAmount).toLocaleString()} å…ƒ/æœˆ
            </div>
            <h4>å¹´é½¡èª¿æ•´ï¼š</h4>
            <p style="color: #555; margin: 0.5em 0;">${result.adjustmentNote}</p>
            <ul style="margin: 0.5em 0; color: #555;">
              <li>åŸºæœ¬çµ¦ä»˜ç‡ï¼š<span class="highlight">1.3%</span></li>
              <li>æœªèª¿æ•´æœˆçµ¦ä»˜ï¼š${Math.round(result.monthlyBase).toLocaleString()} å…ƒ</li>
              <li>èª¿æ•´ä¿‚æ•¸ï¼š${result.ageAdjustment.toFixed(2)}</li>
              <li>èª¿æ•´å¾Œæœˆçµ¦ä»˜ï¼š${Math.round(result.monthlyAmount).toLocaleString()} å…ƒ</li>
            </ul>
            <div class="warning-box">
              âš ï¸ é ä¼°é¤˜å‘½ ${result.lifeExpectancy} å¹´ï¼Œçµ‚èº«ç¸½é¡ç´„ <span class="highlight">${Math.round(result.lifetimeTotal / 10000).toLocaleString()} è¬å…ƒ</span>
            </div>
          </div>
        `;
        
        infoSection.innerHTML = `
          <div class="info-section">
            <h4>ğŸ“‹ å…¬ä¿é¤Šè€çµ¦ä»˜èªªæ˜</h4>
            <ul>
              <li><strong>çµ¦ä»˜æ¨™æº–ï¼š</strong>ä¿éšªå¹´è³‡ Ã— 1.3% Ã— å¹³å‡æœˆè–ªè³‡</li>
              <li><strong>åŸºæº–å¹´é½¡ï¼š</strong>65æ­²é€€ä¼‘ç„¡èª¿æ•´</li>
              <li><strong>æå‰é€€ä¼‘ï¼š</strong>æ¯æå‰1å¹´æ¸›çµ¦ <span class="highlight">4%</span>ï¼Œæœ€å¤šæ¸›20%</li>
              <li><strong>å»¶å¾Œé€€ä¼‘ï¼š</strong>æ¯å»¶å¾Œ1å¹´å¢çµ¦ <span class="highlight">4%</span>ï¼Œæœ€å¤šå¢20%</li>
              <li><strong>å¹³å‡è–ªè³‡ï¼š</strong>é€€ä¼‘å‰æœ€å¾Œåœ¨è·15å¹´å¹³å‡æœˆæŠ•ä¿è–ªè³‡</li>
              <li><strong>çµ¦ä»˜æ–¹å¼ï¼š</strong>æŒ‰æœˆçµ¦ä»˜è‡³èº«æ•…ç‚ºæ­¢</li>
            </ul>
          </div>
        `;
      }
    }

    function downloadCSV() {
      if (!cachedResult) {
        alert('è«‹å…ˆè¨ˆç®—çµæœ');
        return;
      }

      const result = cachedResult;
      let csvContent = '\uFEFF'; // UTF-8 BOM
      csvContent += 'å…¬ä¿é€€ä¼‘é‡‘è¨ˆç®—çµæœ\n';
      csvContent += `è¨ˆç®—æ¨¡å¼,${result.mode === 'lump' ? 'ä¸€æ¬¡é¤Šè€çµ¦ä»˜' : 'é¤Šè€å¹´é‡‘çµ¦ä»˜'}\n`;
      csvContent += `ä¿éšªå¹´è³‡,${result.years} å¹´\n`;
      csvContent += `å¹³å‡æœˆè–ªè³‡,${result.salary.toLocaleString()} å…ƒ\n\n`;

      if (result.mode === 'lump') {
        csvContent += 'çµ¦ä»˜é …ç›®,é‡‘é¡\n';
        csvContent += `çµ¦ä»˜æœˆæ•¸,${result.months} å€‹æœˆ\n`;
        csvContent += `ä¸€æ¬¡é ˜å–ç¸½é¡,${result.totalAmount.toLocaleString()} å…ƒ\n\n`;
        csvContent += 'çµ¦ä»˜æœˆæ•¸è¨ˆç®—æ˜ç´°\n';
        result.breakdown.forEach(item => {
          csvContent += `${item}\n`;
        });
      } else {
        csvContent += 'çµ¦ä»˜é …ç›®,é‡‘é¡\n';
        csvContent += `é€€ä¼‘å¹´é½¡,${result.age} æ­²\n`;
        csvContent += `å¹´é½¡èª¿æ•´,${result.adjustmentNote}\n`;
        csvContent += `æ¯æœˆå¹´é‡‘,${Math.round(result.monthlyAmount).toLocaleString()} å…ƒ\n`;
        csvContent += `æ¯å¹´å¹´é‡‘,${Math.round(result.annualAmount).toLocaleString()} å…ƒ\n`;
        csvContent += `é ä¼°é¤˜å‘½,${result.lifeExpectancy} å¹´\n`;
        csvContent += `é ä¼°çµ‚èº«ç¸½é¡,${Math.round(result.lifetimeTotal).toLocaleString()} å…ƒ\n`;
      }

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const filename = result.mode === 'lump' ? 'å…¬ä¿ä¸€æ¬¡é¤Šè€çµ¦ä»˜.csv' : 'å…¬ä¿é¤Šè€å¹´é‡‘çµ¦ä»˜.csv';
      link.setAttribute('href', URL.createObjectURL(blob));
      link.setAttribute('download', filename);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // æŒ‰ Enter éµä¹Ÿå¯ä»¥è¨ˆç®—
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        calculate();
      }
    });
  </script>
</body>
</html>
